"use strict";function _toConsumableArray(e){if(Array.isArray(e)){for(var t=0,a=Array(e.length);t<e.length;t++)a[t]=e[t];return a}return Array.from(e)}var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};!function(e,t){function a(){var t,a={templateId:"template-voyage-item",resultsWrapper:document.getElementById("tiles"),mainWrapper:document.getElementById("voyage_finder")},i=k(a.templateId),l=!1,y={};mainVariables.getVoyages().then(function(w){var b=w.VoyageCollection,k=w.Filters,I=n(w.VoyageCollection);localStorage.setItem("filteredVoyages",JSON.stringify([]));var D=e(a.mainWrapper),L=a.mainWrapper.querySelector("#filter_dropdown"),N=a.mainWrapper.querySelector("#filter_menu");L.innerHTML+=C(k),N.innerHTML+=x(k);var F=a.mainWrapper.querySelector("#searchbox");h(b,F),v();var T=e("#site-main").attr("class")?e("#site-main").attr("class"):"",V=e('[data-id="main_flag"]').attr("class");e(".jsDestinationSearch").select2({data:I,theme:"custom-option-select custom-option-select-search-"+T+V,placeholder:"Enter your destination.",minimumInputLength:3,minimumResultsForSearch:20});var O=[];if(e(".jsDestinationSearch").on("change",function(t){var a=e(".jsDestinationSearch").val(),n=[];a||(a=[]),(a||("undefined"==typeof a?"undefined":_typeof(a))===array)&&(a.length>O.length?(n=_.difference(a,O),e(".regular-select-search").addClass("focus-input-label")):n=_.difference(O,a),O=a),0===a.length&&e(".regular-select-search.focus-input-label").removeClass("focus-input-label"),n.length>0&&o.trigger("filtering",[{parent:"ports",text:n[0],data:n[0].toLowerCase()}])}),""!==location.search)D.find(".results_number").text(b.length);else var P=Math.floor(.75*b.length),E=setInterval(function(){P<b.length?(D.find(".results_number").text(P+1),P+=1):clearInterval(E)},5);D.find(".number_voyages").text(b.length);var M,H=p(k),A=0,U=e("a.show-more"),B=e(".voyage_finder_sort_select"),J=new Date;J=J.toUTCString(),J=J.split(" "),D.find('.durations h4:contains("'+J[3]+'")').next("ul").find('a:contains("'+J[1]+'")').parents("li").prevAll().children("a").addClass("unavailable");var j=[];o.on("filtering",function(n,r,o){var u;u=b,l=r.parent;var p=H[r.parent].findIndex(function(e){return e.text===r.text&&e.data===r.data});p!==-1?H[r.parent].splice(p,1):H[r.parent].push({text:r.text,data:r.data});var v=[];j=[];for(var h=0;h<u.length;h++){var w=u[h],x=r.parent;if(0!==H[x].length)for(var C=0;C<H[x].length;C++){var I=H[x][C];if("regions"===x?v=g(["RegionCodes",I.data],w):"voyage-types"===x?v=g(["Type",I.data],w):"ship-types"===x?v=g(["ShipName",I.text],w):"dates"===x?v=g(["BeginDate",[I.text,I.data]],w):"duration"===x?v=g(["Duration",I.data],w):"themes"===x?v=g(["Themes",I.text],w):"offers"===x?v=g(["SpecialOffers",I.text],w):"ports"===x&&(v=g(["Ports",I.text],w)),0!==v.length){var L;(L=j).push.apply(L,_toConsumableArray(v))}}}j=j.filter(function(e,t,a){return t===a.findIndex(function(t){return t.VoyageId===e.VoyageId})}),y[r.parent]=j;var N=[],F=1;for(var T in y)F++,y[T].length>0&&(N=0===N.length?y[T]:_.intersection(N,y[T]));j=N;var V=d(H);if(history.pushState){var O=window.location.protocol+"//"+window.location.host+window.location.pathname+V;window.history.pushState({path:O},"",O),window.mainVariables.setRedirectUrl()}var P={};k.map(function(e){e.filter_data.map(function(e){P[e.slug]=[]})}),j.map(function(e){var t=new Date(e.BeginDate.replace(/-/g,"/"));t=t.toDateString(),t=t.split(" "),P.dates.push({text:[t[1].toLowerCase(),t[3]]}),P.duration.push({text:e.Duration}),P.regions.push({text:e.RegionCodes}),P["voyage-types"].push({text:e.Type.toLowerCase()}),P["ship-types"].push({text:e.ShipName}),P.themes.push({text:e.Themes}),P.offers.push({text:e.SpecialOffers})});var E=0;for(var W in P)0!==P[W].length&&(E+=1);var R=D.find("[data-slug]").not('[data-slug="'+l+'"]');if(R.find("a").removeClass("available unavailable"),0!==E){for(var G in P)P[G].map(function(t){if("dates"===G)R.find('h4:contains("'+t.text[1]+'")').next("ul").find('a:contains("'+(t.text[0][0].toUpperCase()+t.text[0].substring(1))+'")').addClass("available");else if("duration"===G)for(var a=D.find('[data-slug="'+G+'"]').find("a"),n=0;n<a.length;n++){var r=a[n].dataset.item.split("-");1===r.length?0===n?t.text<=Number(r[0])&&e(a[n]).addClass("available"):t.text>=Number(r[0])&&e(a[n]).addClass("available"):t.text>=Number(r[0])&&t.text<=Number(r[1])&&e(a[n]).addClass("available")}else if("regions"===G)for(var i=t.text,o=0,s=i.length;o<s;o++)R.find('.list:not(.cruise_type) a[data-item="'+i[o]+'"]').addClass("available");else if("themes"===G)for(var l=t.text,c=0,d=l.length;c<d;c++)R.find('.list:not(.cruise_type) a:contains("'+l[c]+'")').addClass("available");else if("offers"===G)for(var u=t.text,f=0,p=u.length;f<p;f++)R.find('.list:not(.cruise_type) a:contains("'+u[f]+'")').addClass("available");else"voyage-types"===G?R.find('a[data-item="'+t.text+'"]').addClass("available"):"string"==typeof t.text&&(R.find('.list:not(.cruise_type) a:contains("'+t.text+'")').addClass("available"),R.find('.list:not(.cruise_type) a[data-item="'+t.text+'"]').addClass("available"))});R.find("a").not(".available").addClass("unavailable"),t=m(j,12),M=j}else t=m(b,12),M=b,D.find(".filters a").removeClass("available unavailable");A=0,""!==B.val()&&(M=f(B.val(),M),t=m(M,12)),localStorage.setItem("filteredVoyages",JSON.stringify(M)),D.find(".results_number").text(M.length),D.find(".number_voyages").text(M.length),1===M.length?D.find(".length-check").hide():D.find(".length-check").show(),a.resultsWrapper.innerHTML=S(i,t[0]),e(".loading").fadeOut(),e(".voyage_finder_results").show(),window.mainVariables.bLazy.revalidate(),window.wishList.addClickHandlers(),setTimeout(function(){window.readMore.init()},100),t.length>1?U.show():U.hide(),0!==D.find(".selected").length||e(".jsDestinationSearch option:selected").length>0?e(".clear-filter").show():(e(".clear-filter").hide(),localStorage.setItem("filteredVoyages",JSON.stringify([]))),D.find('.durations h4:contains("'+J[3]+'")').next("ul").find('a:contains("'+J[1]+'")').parents("li").prevAll().children("a").addClass("unavailable"),s(),c()}),t=m(b,12),M=b,a.resultsWrapper.innerHTML=S(i,t[0]),e(".loading").fadeOut(),e(".voyage_finder_results").show(),window.mainVariables.bLazy.revalidate(),window.wishList.addClickHandlers(),setTimeout(function(){window.readMore.init()},100),D.on("click",".clear-filter",function(n){if(n.preventDefault(),n.stopPropagation(),e(this).hide(),history.pushState){var r=window.location.protocol+"//"+window.location.host+window.location.pathname;window.history.pushState({path:r},"",r)}localStorage.setItem("filteredVoyages",JSON.stringify([])),e(".filter_close").hide(),e(".filter_menu_link .subtext").text(""),e(".jsDestinationSearch").val(null).trigger("change"),H=p(k),y={},l=!1,e("body").removeClass("mobile-open"),D.find(".filter_options .container-padded").removeClass("open-filter-options"),D.find(".filters a").removeClass("unavailable available active selected"),D.find(".filter_menu_link").removeClass("active"),D.find('.durations h4:contains("'+J[3]+'")').next("ul").find('a:contains("'+J[1]+'")').parents("li").prevAll().children("a").addClass("unavailable"),t=m(b,12),""!==B.val()&&(M=f(B.val(),b),t=m(M,12)),D.find(".results_number").text(b.length),D.find(".number_voyages").text(b.length),a.resultsWrapper.innerHTML=S(i,t[0]),e(".loading").fadeOut(),e(".voyage_finder_results").show(),window.mainVariables.bLazy.revalidate(),window.wishList.addClickHandlers(),A=0,U.show(),setTimeout(function(){window.readMore.init()},100),s(),c()}).on("change",".voyage_finder_sort_select",function(n){n.preventDefault(),n.stopPropagation();var r=e(this);M=f(r.val(),M),A=0,t=m(M,12),a.resultsWrapper.innerHTML=S(i,t[0]),s(),c(),e(".loading").fadeOut(),e(".voyage_finder_results").show(),window.mainVariables.bLazy.revalidate(),window.wishList.addClickHandlers(),setTimeout(function(){window.readMore.init()},100),t.length>1?U.show():U.hide()}),U.on("keyup",function(e){if(13===e.keyCode)for(var t=12,a=document.getElementById("tiles"),n=a.getElementsByClassName("to-focus"),r=n.length,i=r-t,o=0;o<n.length;o++)i===o&&n[o].focus()}),U.on("click",function(n){n.preventDefault(),n.stopPropagation();var r=e(this);t.length-1>A?(A+=1,a.resultsWrapper.innerHTML+=S(i,t[A]),e(".loading").fadeOut(),e(".voyage_finder_results").show(),window.mainVariables.bLazy.revalidate(),window.wishList.addClickHandlers(),setTimeout(function(){window.readMore.init()},100),t.length-1===A&&r.hide()):r.hide(),s(),c()}),u(),r()})}function n(e){var t=1,a=1,n=[{id:t,text:e[0].Ports.length>0?e[0].Ports[0].country:"",children:[]}];return t+=1,e.forEach(function(e){e.Ports.forEach(function(e){var r=_.find(n,function(t){return t.text===e.country});if(r){var i=_.find(r.children,function(t){return t.id===e.placeName});i||r.children.push({id:e.placeName,text:e.placeName+", "+e.country})}else n.push({text:e.country,id:t,children:[{id:e.placeName,text:e.placeName+", "+e.country}]}),a+=1,t+=1})}),n}function r(){var t=e(".last_year").first();0===t.children().length&&(t.parent().hide(),t.parent().next().hide())}function i(){var t=e(window).scrollTop()+e(window).height(),a=e("#tiles").offset().top+e("#tiles").outerHeight()+e(".tiles_actions").outerHeight();t<a?(e(".tiles_actions").addClass("tiles_actions_sticky"),e(".tiles_actions").addClass("tiles_actions_remove_btn")):(e(".tiles_actions").removeClass("tiles_actions_sticky"),e(".tiles_actions").removeClass("tiles_actions_remove_btn"))}if(0===e(".jsVoyageFinder").length)return!1;e(".loading").show();var o=e("body");window.localStorage.setItem("voyages_to_compare",""),window.localStorage.setItem("checkboxValues",JSON.stringify({}));var s=function(){var t=JSON.parse(window.localStorage.getItem("checkboxValues"));Object.keys(t).map(function(a){var n=t[a];e("#"+a).prop("checked",n),n===!0?(e("#"+a).parent().addClass("now-selected"),e("#"+a).parent().addClass("selected")):(e("#"+a).parent().removeClass("now-selected"),e("#"+a).parent().removeClass("selected"))})},l=function(){var e=JSON.parse(window.localStorage.getItem("checkboxValues")),t=0;return Object.keys(e).map(function(a){e[a]===!0&&t++}),t},c=function(){var t=l();e(".button.compare").toggleClass("disabled_link",t<2),t>=1?(i(),e(".tiles_actions .compare small").text(t+" of 3 Selected"),e(".tiles_actions .clear-link").css("display","inline-block"),t>=3?3==t&&e(".voyage_finder_results").addClass("checkboxFilled"):e(".voyage_finder_results").removeClass("checkboxFilled")):(e(".tiles_actions").removeClass("tiles_actions_sticky"),e(".tiles_actions .compare small").text("Up to 3"),e(".tiles_actions .clear-link").hide())},d=function(e){var t="?",a=0;for(var n in e){var r="";if(0!==e[n].length){a+=1;var i=0;1!==a&&(r+="&&"),e[n].map(function(e,t){i+=1,r+=1===i?n+"="+e.text+"++"+e.data:"|"+e.text+"++"+e.data}),t+=r}}return t},u=function(t){var a=e("#filter_dropdown"),n=unescape(window.location.search);""!==n&&(n=n.slice(1).split("&&"),n.map(function(t){t=t.split("=");var n=t[0],r=t[1].split("|"),i=a.find('[data-slug="'+n+'"]');r.map(function(t){if(t=t.split("++"),"regions"===n||"voyage-type"===n||"duration"===n)i.find('a[data-item="'+t[1]+'"]').click();else if("dates"===n)i.find('h4:contains("'+t[1]+'")').siblings("ul").find('li a:contains("'+t[0]+'")').click();else if("duration"===n)i.find('h4:contains("'+t[1]+'")').siblings("ul").find('li a:contains("'+t[0]+'")').click();else if("ports"===n){var a=[];r.forEach(function(e){a.push(e.substr(0,e.lastIndexOf("++")))}),e(".jsDestinationSearch").val(a),e(".jsDestinationSearch").trigger("change")}else i.find('a:contains("'+t[0]+'")').click()})}))},f=function(e,t){return"length"===e?t=t.sort(function(e,t){return e.Duration>t.Duration?1:e.Duration<t.Duration?-1:0}):"price"===e?t=t.sort(function(e,t){return e.FaresFromUs>t.FaresFromUs||e.FaresFromGb>t.FaresFromGb?1:e.FaresFromUs<t.FaresFromUs|e.FaresFromGb<t.FaresFromGb?-1:0}):"departure"===e?t=t.sort(function(e,t){return e.EmbarkText>t.EmbarkText?1:e.EmbarkText<t.EmbarkText?-1:0}):"date"===e&&(t=t.sort(function(e,t){return new Date(e.BeginDate.replace(/-/g,"/"))>new Date(t.BeginDate.replace(/-/g,"/"))?1:new Date(e.BeginDate.replace(/-/g,"/"))<new Date(t.BeginDate.replace(/-/g,"/"))?-1:0})),t},p=function(e){var t={};return e.map(function(e){e.filter_data.map(function(e){return t[e.slug]=[]})}),t.ports=[],t},g=function(e,t){var a=[];if(""!==e[0]&&""!==e[1])if(Array.isArray(t[e[0]])&&0!==t[e[0]].length)if("Ports"===e[0]){var n=_.find(t.Ports,function(t){return t.placeName.lastIndexOf(e[1])!==-1});n&&a.push(t)}else{var r,i=e[1].split("-");r=i.length>1?t[e[0]].filter(function(t,a){return t.toLowerCase()===i[1].toLowerCase()||t.toLowerCase()===i[0].toLowerCase()||t.toLowerCase()===e[1].toLowerCase()}):t[e[0]].filter(function(t,a){return t.toLowerCase()===e[1].toLowerCase()}),0!==r.length&&a.push(t)}else if("BeginDate"===e[0]){var o=e[1],s=new Date(t[e[0]].replace(/-/g,"/"));s=s.toDateString(),s=s.split(" "),s[1].toLowerCase()===o[0].toLowerCase()&&s[3]===o[1]&&a.push(t)}else if("Duration"===e[0]){var l=e[1].split("-");2===l.length?t[e[0]]>=Number(l[0])&&t[e[0]]<=Number(l[1])&&a.push(t):1===l.length&&(4===Number(l[0])&&t[e[0]]<=Number(l[0])?a.push(t):26===Number(l[0])&&t[e[0]]>=Number(l[0])&&a.push(t))}else"string"==typeof t[e[0]]&&t[e[0]].toLowerCase()===e[1].toLowerCase()&&a.push(t);return a},m=function(e,t){var a=[],n=0,r=[];return e.map(function(i,o){n+=1,n<=t&&r.push(i),n===t&&(a.push(r),r=[],n=0),o===e.length-1&&n<t&&r.length>0&&a.push(r)}),a},v=function(t){var a=e(".voyage_finder"),n=e("body");a.on("click",".filter_menu_link",function(t){t.preventDefault(),t.stopPropagation(),n.addClass("mobile-open"),e(".filter_menu").addClass("active-link");var r=e(this);e(".filter_close").show(),r.hasClass("active")||(r.addClass("active"),a.find(".filter_menu_link").not(this).removeClass("active"));var i=r.attr("href").slice(1);a.find(".filter_options").addClass("mobile-show"),a.find(".filter_options .container-padded").addClass("open-filter-options"),a.find(".filters").hide(),a.find(".filters").eq(Number(i)).show()}).on("click",'.filters a:not(".unavailable")',function(t){t.preventDefault(),t.stopPropagation();var r=e(this);if(r.attr("data-redirect")){var i=window.open(r.attr("data-redirect"),"_blank");return i.focus(),!0}r.toggleClass("selected");var o=r.parents(".filters").index()+1,s=a.find(".filter_menu li").eq(o).find("a .subtext"),l="";r.parents(".filters").find(".selected").length>0&&(l="("+r.parents(".filters").find(".selected").length+") ");var c;r.parents(".filters").find(".selected").map(function(t,a){r.parents(".filters").find(".selected").length>1?(c=e(a).text()+",",r.parents(".filters").find(".selected").length===t+1&&(c=e(a).text())):c=e(a).text(),l+=c}),s.text(l);var d={parent:r.parents("[data-slug]").attr("data-slug"),text:r.text(),data:""!==r.attr("data-item")?r.attr("data-item"):r.parents(".list").find("h4").text()};n.trigger("filtering",[d,r])}).on("click",".filter_close",function(t){t.preventDefault(),t.stopPropagation(),e(this).hide(),n.removeClass("mobile-open"),a.find(".filter_menu_link").removeClass("active"),setTimeout(function(){a.find(".filter_options").removeClass("mobile-show")},300),a.find(".filter_options .container-padded").removeClass("open-filter-options"),a.find(".filter_menu").removeClass("active-link"),a.find(".filter_options .container-padded").attr("tabindex","-1")}).on("click",".voyage_finder_toggle a",function(t){t.preventDefault(),t.stopPropagation();var a=e(this);a.hasClass("active")&&(a.hasClass("toggle_grid")?(a.removeClass("active"),a.siblings().addClass("active"),e(".voyage_finder_results").removeClass("list")):(a.removeClass("active"),a.siblings().addClass("active"),e(".voyage_finder_results").addClass("list")))}).on("click",".mobile_view_btn a",function(e){e.preventDefault(),e.stopPropagation(),a.find(".filter_close").click()})},h=function(t,a){var n=e(a).next(".results");e(a).on("keyup",function(){var e=this,a=t.filter(function(t,a){return t.Ports.filter(function(t,a){return t.placeName.toLowerCase().indexOf(e.value.toLowerCase())!==-1})});"undefined"!=typeof a[0]&&""!==this.value?n.text(a[0].DestinationCodes):(n.text("No results"),n.attr("data-code",""))}),n.on("click",function(){e('[data-item="'+this.dataset.code+'"]').click(),n.text(""),e(a).val("")})},y=function(e){var t=[].concat(_toConsumableArray(document.querySelectorAll("[class^=template-filter]"))),a=[];return t.map(function(e,t){a.push({html:e.innerHTML,slug:e.dataset.slug,data:{subfirst:e.dataset.subfirst,subsec:e.dataset.subsec}})}),a},w=function(e,t){return e.filter(function(e){return e.slug===t})[0]},b=function(e,t,a,n,r){return e=e.replace(/%%item_loop_href%%/g,"#"+t),e=e.replace(/%%id_item%%/g,t),e=r?e.replace(/%%data%%/g,n):e.replace(/%%data%%/g,""),e=e.replace(/%%item_name%%/g,a)},x=function(e){var t="";return e.map(function(e,a){var n=k("template-navfilter-item");n=n.replace(/%%filterName%%/g,e.filter_name),n=n.replace(/%%filterHref%%/g,"#"+a),t+=n}),t},C=function(e){var t=y(),a="";return e.map(function(e,n){var r=w(t,e.filter_slug),i=r.html;i=i.replace(/%%filter_name%%/g,e.filter_name),e.filter_data.map(function(e,a){var n="";e.data.map(function(e,a){var o=w(t,"global"),s=o.html;if(s=b(s,a,e.item_name.name,e.item_name.data,!0),0!==e.item_subdata.length){var l,c,d="";for(var u in r.data)"true"===r.data[u]&&("subfirst"===u?(l=new RegExp("%%name_0_"+a+"%%","g"),c=new RegExp("%%body_loop_items_0_"+a+"%%","g")):(l=new RegExp("%%name_1_"+a+"%%","g"),c=new RegExp("%%body_loop_items_1_"+a+"%%","g")),e.item_subdata.map(function(e,t){var a=o.html;a=b(a,t,e,t,!1),d+=a}));i=i.replace(c,d),i=i.replace(l,e.item_name.name)}n+=s});var o=new RegExp("%%name_"+a+"%%","g");i=i.replace(o,e.name),o=new RegExp("%%body_loop_items_"+a+"%%","g"),i=i.replace(o,n)}),a+=i}),a},k=function(e){return document.getElementById(e).innerHTML},S=function(e,t){var a="";return t.map(function(t,n){var r=e;r=r.replace(/%%index%%/g,100*n),r=r.replace(/%%VoyageId%%/g,t.VoyageId),r=r.replace(/%%Id%%/g,t.Id),r=r.replace(/%%Name%%/g,t.ShipName),r=r.replace(/%%Duration%%/g,t.Duration);var i="showPrice";0!==t.FaresFromGb&&0!==t.FaresFromUs||(i="hidePrice"),r=r.replace(/%%callForAvailability%%/g,i),r=r.replace(/%%fareFromGb%%/g,"£"+t.FaresFromGb.formatMoney(0,".",",")),r=r.replace(/%%fareFromUs%%/g,"$"+t.FaresFromUs.formatMoney(0,".",",")),r=r.replace(/%%fareFromTooltip%%/g,t.FaresFromTooltip),r=r.replace(/%%urlName%%/g,t.UrlName),r=r.replace(/%%backgroundImage%%/g,t.Image);var o=t.EmbarkText.replace("/"," / ");o=o.split(" to "),o.length>1?(r=r.replace(/%%fromLocation%%/g,o[0]+" to "),r=r.replace(/%%toLocation%%/g,o[1])):(r=r.replace(/%%fromLocation%%/g,o[0]),r=r.replace(/%%toLocation%%/g,""));var s="";t.Ports.map(function(e,a){s+=e.placeName+", "+e.country,a!==t.Ports.length-1&&(s+='<i class="sep">…</i>')}),r=r.replace(/%%description%%/g,s);var l="";t.Themes&&t.Themes.length>0?(l+="Theme(s): ",t.Themes.map(function(e,a){l+=e,a!==t.Themes.length-1&&(l+='<i class="sep">…</i>')}),r=r.replace(/%%themes%%/g,l)):r=r.replace(/%%themes%%/g,"");var c=new Date(t.BeginDate.replace(/-/g,"/"));c=c.toUTCString(),c=c.split(" "),r=r.replace(/%%departureMonth%%/g,c[2]),r=r.replace(/%%departureDay%%/g,c[1]),r=r.replace(/%%departureYear%%/g,c[3]),a+=r}),a},I=function(){var e=localStorage.getItem("voyagesId");(e||null!==e)&&localStorage.removeItem("voyagesId")};a(),I();var D={$body:e("body"),comparable:[],voyagesSave:[],saveVoyage:function(){event.preventDefault();var e=D,t={voyageId:this.id},a=localStorage.getItem("voyagesId");if(null===a)e.voyagesSave.push(t),localStorage.setItem("voyagesId",JSON.stringify(e.voyagesSave));else{var n=JSON.parse(a),r=n.filter(function(e,a){return e.voyageId===t.voyageId});1!==r.length&&(e.voyagesSave.push(t),localStorage.setItem("voyagesId",JSON.stringify(e.voyagesSave)))}},buttonCompare:function(t){t.stopPropagation();var a=JSON.parse(window.localStorage.getItem("checkboxValues"))||{},n=e('.voyage_finder_results input[type="checkbox"]');n.each(function(t){var n=e(this).attr("id"),r=e(this).prop("checked");a[n]=r}),window.localStorage.setItem("checkboxValues",JSON.stringify(a)),e(this).parent().toggleClass("now-selected"),e(this).parent().addClass("selected"),c();var r=t.currentTarget.id.replace("compare_",""),i=window.localStorage.getItem("voyages_to_compare");i=i?i:"",t.currentTarget.checked?i+=r+"/":i=i.replace(r+"/",""),window.localStorage.setItem("voyages_to_compare",i),window.localStorage.getItem("voyages_to_compare")&&e(".js_voyage_compare").attr("data-url","/tour/compare/voyages/"+window.localStorage.getItem("voyages_to_compare"))},clearCheckboxes:function(t){t.stopPropagation(),t.preventDefault(),e('.voyage_finder_results input[type="checkbox"]').parent().removeClass("now-selected"),e('.voyage_finder_results input[type="checkbox"]').parent().removeClass("selected"),e('.voyage_finder_results input[type="checkbox"]').prop("checked",!1),e(".voyage_finder_results").removeClass("checkboxFilled"),e(".clear-link").hide(),window.localStorage.setItem("checkboxValues",JSON.stringify({})),window.localStorage.setItem("voyages_to_compare",""),c()}};D.$body.on("change",'.voyage_finder_results input[type="checkbox"]',D.buttonCompare).on("click",".tiles_actions .clear-link",D.clearCheckboxes),e(window).scroll(function(){c()})}(jQuery,window.talonUtil);