"use strict";!function(e,a){window.RelatedVoyages={init:function(){var e=window.RelatedVoyages;mainVariables.getVoyages().then(function(a){e.prepRelatedVoyages(a)})},prepRelatedVoyages:function(a){var r=window.RelatedVoyages,t={templateId:"template-voyage-item",resultsWrapper:document.getElementById("tiles")},o=r.templateGenerator(t.templateId),n=a.VoyageCollection,l=JSON.parse(localStorage.getItem("filteredVoyages")),i=[],g=e("#currentVoyage").length>0?e("#currentVoyage").attr("data-voyageid"):null;if(null!==l&&l.length>0){for(var s=0;s<l.length;s++)g!==l[s].VoyageId&&i.push(l[s]);s=0;do{if(g!==n[s].VoyageId){for(var c=!1,p=0;p<i.length;p++)n[s].VoyageId===i[p].VoyageId&&(c=!0);c||i.push(n[s])}s+=1}while(i.length<6);i.splice(6),t.resultsWrapper.innerHTML=r.generateHTML(o,i),setTimeout(function(){window.mainVariables.bLazy.revalidate(),window.wishList.addClickHandlers()},500)}else{for(s=0;s<6;s++){var d=n.filter(function(e,a){if(e.VoyageId!==g)return e});i.push(d[s])}t.resultsWrapper.innerHTML=r.generateHTML(o,i),setTimeout(function(){window.mainVariables.bLazy.revalidate(),window.wishList.addClickHandlers()},500)}},templateGenerator:function(e){return document.getElementById(e).innerHTML},generateHTML:function(e,a){var r="";return a.map(function(a,t){var o=e;o=o.replace(/%%index%%/g,200*t),o=o.replace(/%%VoyageId%%/g,a.VoyageId),o=o.replace(/%%Name%%/g,a.ShipName),o=o.replace(/%%Duration%%/g,a.Duration),o=o.replace(/%%fareTooltip%%/g,a.FaresFromTooltip);var n="showPrice";0!==a.FaresFromGb&&0!==a.FaresFromUs||(n="hidePrice"),o=o.replace(/%%callForAvailability%%/g,n),o=o.replace(/%%fareFromGb%%/g,"£"+a.FaresFromGb.formatMoney(0,".",",")),o=o.replace(/%%fareFromUs%%/g,"$"+a.FaresFromUs.formatMoney(0,".",",")),o=o.replace(/%%urlName%%/g,a.UrlName),o=o.replace(/%%backgroundImage%%/g,a.Image);var l=a.EmbarkText.replace("/"," / ");l=l.split(" to "),l.length>1?(o=o.replace(/%%fromLocation%%/g,l[0]+" to "),o=o.replace(/%%toLocation%%/g,l[1])):(o=o.replace(/%%fromLocation%%/g,l[0]),o=o.replace(/%%toLocation%%/g,""));var i="";a.Ports.map(function(e,r){i+=e.placeName+", "+e.country,r!==a.Ports.length-1&&(i+='<i class="sep">…</i>')}),o=o.replace(/%%description%%/g,i);var g=new Date(a.BeginDate);g=g.toUTCString(),g=g.split(" "),o=o.replace(/%%departureDay%%/g,g[1]),o=o.replace(/%%departureMonth%%/g,g[2]),o=o.replace(/%%departureYear%%/g,g[3]),r+=o}),r}},e(".jsRelatedVoyages").length>0&&window.RelatedVoyages.init()}(jQuery,window.talonUtil);