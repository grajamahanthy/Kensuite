var sfDataIntell=sfDataIntell||{};sfDataIntell.constants={sdkVersion:"js-3.0.1",cookieName:"sf-data-intell-subject",endpoints:{apiServer:"https://api.dec.sitefinity.com"},headers:{authorization:"Authorization",datacenterkey:"x-dataintelligence-datacenterkey",subject:"x-dataintelligence-subject",ids:"x-dataintelligence-ids",datasource:"x-dataintelligence-datasource",contacts:"x-dataintelligence-contacts",sdkVersion:"x-dataintelligence-sdk-version"}};var sfDataIntell=sfDataIntell||{};sfDataIntell.utils={visitPredicate:"Visit",getEndpointUrl:function(a,b,c){return a+"/collect/v2/data-centers/"+b+"/datasources/"+c+"/interactions"},getSentencesRequestOptions:function(a,b,c){1==b.length&&(b=b[0]);var d=sfDataIntell.utils.getEndpointUrl(a.apiServerUrl,a.apiKey,a.source);return sfDataIntell.utils.getRequestOptions(b,"POST",d,c)},getRequestOptions:function(a,b,c,d){var e={method:b,url:c,contentType:"application/json",headers:d||{},data:a};return e.headers[sfDataIntell.constants.headers.sdkVersion]=sfDataIntell.constants.sdkVersion,e},translateOldToNewFormat:function(a){var b={};if(a instanceof Array)for(i=0;i<a.length;i++){var c=a[i];c.K&&c.V&&(b[c.K]=c.V)}else b=a;return b},addReferrer:function(a){window&&window.decMetadata&&window.decMetadata.contentMetadata&&(window.decMetadata.contentMetadata.PageId&&(a.PageId=window.decMetadata.contentMetadata.PageId),window.decMetadata.contentMetadata.Language&&(a.Language=window.decMetadata.contentMetadata.Language),window.decMetadata.contentMetadata.SiteName&&(a.SiteName=window.decMetadata.contentMetadata.SiteName),window.decMetadata.contentMetadata.Id&&(a.ReferrerId=window.decMetadata.contentMetadata.Id),window.decMetadata.contentMetadata.ContentType&&(a.ReferrerType=window.decMetadata.contentMetadata.ContentType),window.decMetadata.contentMetadata.SFDataProviderName&&(a.ReferrerProvider=window.decMetadata.contentMetadata.SFDataProviderName))}};var sfDataIntell=sfDataIntell||{};!function(a){a.Client=function(b){var c=this;if(b=b||{},!b.apiKey)throw new Error('You must provide the "apiKey" for the Data Center.');if(!b.source)throw new Error('You must provide the "source" name for the data center in which data will be reported.');var d=b.enableTracking;null!==b.enableTracking&&void 0!==b.enableTracking||(console.warn('The "enableTracking" option is set to True by default. To disable tracking, change the value to False.'),d=!0),this.apiKey=b.apiKey,this.source=b.source,this.authToken=b.authToken,this.apiServerUrl=b.apiServerUrl||sfDataIntell.constants.endpoints.apiServer,this.pageInfoProvider=b.pageInfoProvider||new a.PageInfoProvider,this.isLocalStorageSupported=this.isLocalStorageSupported();var e=this.readCookie(),f=a.DecRequesterFactory.getRequester(d);this.decRequester=f;var g=!1;if(null!==e&&""!==e||!0!==d||(e=this.generateSubjectKey(),this.setCookie(e,365,b.trackingCookieDomain),g=!0),this.sentenceClient=new a.SentenceClient(e,this.isLocalStorageSupported),!1===d&&(this.sentenceClient.writeSentence=function(){}),b.trackBrowserInformation&&g&&window.detect){var h=this.getParseUserAgent(),i=this.getBrowserLanguage(),j={Browser:h.browser.family,"Browser version":h.browser.version,"Browser language":i,Device:h.device.family,"Device type":h.device.type};null!==h.device.manufacturer&&""!==h.device.manufacturer&&(j["Device manufacturer"]=h.device.manufacturer),this.sentenceClient.writeSentence({subjectMetadata:j})}"boolean"==typeof b.autoTracking?this.autoTracking=b.autoTracking:this.autoTracking=!0,this.subjectMetadataClient=new a.SubjectMetadataClient(this.sentenceClient),this.personalizationClient=new a.PersonalizationClient(this.apiServerUrl,e,this.apiKey,this.source,this.authToken,f),this.v2={},this.v2.personalizationClient=new a.PersonalizationClientV2(this.apiServerUrl,e,this.apiKey,this.source,this.authToken,f),this.mappingsClient=new a.MappingsClient({apiServerUrl:this.apiServerUrl,subject:e,apiKey:this.apiKey,datasource:this.source},this.sentenceClient),b.instrument&&(this.instrumenter=new a.HtmlInstrumenter(this.sentenceClient),this.instrumenter.startTracking()),b.trackPageVisits&&(this.pageVisitsTracker=new a.PageVisitsTracker(this.sentenceClient,{predicate:b.trackPageVisits.predicate,obj:b.trackPageVisits.obj,objMetadata:b.trackPageVisits.objMetadata},this.pageInfoProvider),this.pageVisitsTracker.startTracking()),b.trackUtmParameters&&(this.utmParametersTracker=new a.UtmParametersTracker(this.sentenceClient,b.trackUtmParameters.predicate,b.trackUtmParameters.obj,b.trackUtmParameters.objMetadata,b.trackUtmParameters.subMetadata),this.utmParametersTracker.startTracking()),!0===d&&this.autoTracking&&setInterval(function(){c.flushData(c)},5e3)},a.Client.prototype={generateSubjectKey:function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(a){var b=16*Math.random()|0;return("x"==a?b:3&b|8).toString(16)})},setCookie:function(b,c,d){var e=new Date;e.setTime(e.getTime()+24*c*60*60*1e3);var f="expires="+e.toGMTString(),g=a.constants.cookieName+"="+b+";path=/; "+f;d&&(g+=";domain="+d),document.cookie=g},deleteCookie:function(b){var c=new Date;c.setTime(c.getTime()-9e3);var d="; expires="+c.toGMTString(),e="";b&&(e="; domain="+b),document.cookie=a.constants.cookieName+"="+d+"; path=/"+e},readCookie:function(){for(var b=a.constants.cookieName+"=",c=window.document.cookie.split(";"),d=0;d<c.length;d++){var e=c[d].trim();if(0===e.indexOf(b))return e.substring(b.length,e.length)}return null},flushData:function(a){var b;a.isLocalStorageSupported?localStorage.sentences&&(b=JSON.parse(localStorage.sentences),a.flushSentences(a,b),localStorage.sentences=""):window.tempStorage.sentences&&(b=JSON.parse(window.tempStorage.sentences),a.flushSentences(a,b),window.tempStorage.sentences="")},flushSentences:function(a,b){var c=sfDataIntell.utils.getSentencesRequestOptions(a,b);this.decRequester.ajaxCall(c)},getParseUserAgent:function(){return detect.parse(navigator.userAgent)},getBrowserLanguage:function(){return navigator.language||navigator.userLanguage},isLocalStorageSupported:function(){var a="test";try{return localStorage.setItem(a,"1"),localStorage.removeItem(a),!0}catch(b){return window.tempStorage={},!1}}}}(sfDataIntell);var sfDataIntell=sfDataIntell||{};!function(a){"use strict";var b={getRequester:function(b){return b?new a.DecRequester:new a.DecRequesterMock}};a.DecRequesterFactory=b}(sfDataIntell);var sfDataIntell=sfDataIntell||{};!function(a){"use strict";a.DecRequester=function(){};var b=function(a,b){for(var c in b)a.setRequestHeader(c,b[c])},c=function(a,b,c){if(c)if(b.contentType&&a.response&&"application/json"===b.contentType)try{var d=JSON.parse(a.response);c(d)}catch(e){c(a.response)}else c(a.response)};a.DecRequester.prototype={ajaxCall:function(a,d,e){if(!a)throw new Error("options is required.");if(!a.method)throw new Error("options.method is required.");if(!a.url)throw new Error("options.url is required.");var f=a.method,g=a.url,h=a.data?JSON.stringify(a.data):null,i=new XMLHttpRequest;i.open(f,g,!0),i.onreadystatechange=function(){i.readyState===XMLHttpRequest.DONE&&(i.status>=200&&i.status<300||304===i.status?c(i,a,d):c(i,a,e))};var j=a.headers||{};a.contentType&&(j["Content-Type"]=a.contentType),b(i,j),i.send(h)}}}(sfDataIntell);var sfDataIntell=sfDataIntell||{};!function(a){"use strict";a.DecRequesterMock=function(){},a.DecRequesterMock.prototype={ajaxCall:function(a,b,c){b&&b({})}}}(sfDataIntell);var sfDataIntell=sfDataIntell||{};!function(a){a.HtmlInstrumenter=function(a){this.sentenceClient=a},a.HtmlInstrumenter.prototype={startTracking:function(){var a=this;$("[sfdi-trigger]").each(function(b){var c=$(this),d=c.attr("sfdi-trigger"),e=c.attr("sfdi-predicate"),f=c.attr("sfdi-object"),g=c.attr("sfdi-obj-metadata"),h=c.attr("sfdi-sub-metadata");g=a.buildMetadataArray(g),h=a.buildMetadataArray(h);var i={predicate:e,object:f};g?(i.objectMetadata=sfDataIntell.utils.translateOldToNewFormat(g),i.objectMetadata.ReferrerUrl=location.href):i.objectMetadata={ReferrerUrl:location.href},sfDataIntell.utils.addReferrer(i.objectMetadata),h&&(i.subjectMetadata=sfDataIntell.utils.translateOldToNewFormat(h)),c.on(d,function(){a.sentenceClient.writeSentence(i)})})},buildMetadataArray:function(a){return a?a=JSON.parse(a.replace(new RegExp("\\\\","gm"),"").replace(new RegExp("'","gm"),'"')):null}}}(sfDataIntell);var sfDataIntell=sfDataIntell||{};!function(a){a.SentenceClient=function(a,b){this.subjectKey=a,this.isLocalStorageSupported=b},a.SentenceClient.prototype={writeSentence:function(a){if(!a)throw new Error('You must provide "sentence" argument when writing a sentence.');var b;b=this.isLocalStorageSupported?localStorage.sentences?JSON.parse(localStorage.sentences):[]:window.tempStorage.sentences?JSON.parse(window.tempStorage.sentences):[],a.subjectMetadata&&(a.subjectMetadata=sfDataIntell.utils.translateOldToNewFormat(a.subjectMetadata)),a.objectMetadata&&(a.objectMetadata=sfDataIntell.utils.translateOldToNewFormat(a.objectMetadata)),a.predicate&&a.object&&a.predicate!==sfDataIntell.utils.visitPredicate&&(a.objectMetadata=a.objectMetadata||{},sfDataIntell.utils.addReferrer(a.objectMetadata)),b.push({S:this.subjectKey,P:a.predicate,O:a.object,SM:a.subjectMetadata,OM:a.objectMetadata,MappedTo:a.mappedTo}),this.isLocalStorageSupported?localStorage.sentences=JSON.stringify(b):window.tempStorage.sentences=JSON.stringify(b)}}}(sfDataIntell);var sfDataIntell=sfDataIntell||{};!function(a){a.SubjectMetadataClient=function(a){this.sentenceClient=a},a.SubjectMetadataClient.prototype={writeSubjectMetadata:function(a){if(!a)throw new Error('You must provide "metadata" argument when writing subject metadata.');var b=sfDataIntell.utils.translateOldToNewFormat(a);this.sentenceClient.writeSentence({subjectMetadata:b})}}}(sfDataIntell);var sfDataIntell=sfDataIntell||{};!function(a){a.PageVisitsTracker=function(b,c,d){this.pageInfoProvider=d,this.pageMetadataStorage=new a.PageMetadataStore,this.sentenceClient=b,this.predicate=c.predicate||sfDataIntell.utils.visitPredicate,this.obj=c.obj||this.pageInfoProvider.getCurrentPageUrl(),this.objMetadata=c.objMetadata,window.decMetadata&&window.decMetadata.contentMetadata&&(this.objMetadata=window.decMetadata.contentMetadata)},a.PageVisitsTracker.prototype={startTracking:function(){if(this.objMetadata){var a=this.obj,b={};b.PageId=this.objMetadata.PageId,b.Language=this.objMetadata.Language,this.objMetadata.ABTest&&this.objMetadata.ABTest.Id&&this.objMetadata.ABTest.VariantId&&(b.PreviousPageABTestId=this.objMetadata.ABTest.Id),this.pageMetadataStorage.addMetadata(a,b)}var c=this.pageInfoProvider.getCurrentPageReferrer(),d=this.pageMetadataStorage.getMetadata(c),e=this.enhanceMetadata(this.objMetadata,d);this.sentenceClient.writeSentence({predicate:this.predicate,object:this.obj,objectMetadata:e})},enhanceMetadata:function(a,b){return b&&(a.PreviousPageId=b.PageId,a.PreviousPageLanguage=b.Language,a.PreviousPageABTestId=b.PreviousPageABTestId),this.metadataWithReferrer(a)},metadataWithReferrer:function(a){var b=this.getHostName(document.referrer);return b&&b!==location.hostname&&(a.ReferrerUrl=b),a},getHostName:function(a){if(a){var b=document.createElement("a");return b.href=a,b.hostname}}}}(sfDataIntell);var sfDataIntell=sfDataIntell||{};!function(a){a.UtmParametersTracker=function(a,b,c,d,e){this.sentenceClient=a,this.predicate=b||"Participate in campaign",this.obj=c||location.search,this.objMetadata=d,this.subMetadata=e},a.UtmParametersTracker.prototype={startTracking:function(){this.handleUtmParamsTracking()},handleUtmParamsTracking:function(){var a=this.buildUtmParamsObject(this.obj);null!==a&&this.sentenceClient.writeSentence({predicate:this.predicate,object:a,objectMetadata:this.objMetadata,subjectMetadata:this.subMetadata})},buildUtmParamsObject:function(a){if(a.indexOf("utm_source")>-1||a.indexOf("utm_medium")>-1||a.indexOf("utm_term")>-1||a.indexOf("utm_content")>-1||a.indexOf("utm_campaign")>-1){return"?"+a.slice(1).split("&").filter(function(a){return a.indexOf("utm_source")>-1||a.indexOf("utm_medium")>-1||a.indexOf("utm_term")>-1||a.indexOf("utm_content")>-1||a.indexOf("utm_campaign")>-1}).join("&")}return null}}}(sfDataIntell);var sfDataIntell=sfDataIntell||{};!function(a){a.PersonalizationClient=function(a,b,c,d,e,f){this.apiServerUrl=a,this.subjectKey=b,this.apiKey=c,this.datasource=d,this.authToken=e,this.requester=f},a.PersonalizationClient.prototype={call:function(a,b,c,d){if(!this.authToken)throw new Error('You must provide "authToken" when using the Personalization Client.');if(!this.requester)throw new Error("decRequester was not initialized.");var e=this.apiServerUrl+a,f=sfDataIntell.utils.getRequestOptions(null,"GET",e,b);f.headers[sfDataIntell.constants.headers.authorization]=this.authToken,f.headers[sfDataIntell.constants.headers.datacenterkey]=this.apiKey,this.requester.ajaxCall(f,c,d)},isInCampaigns:function(a,b,c){if(!a)throw new Error('You must provide "campaignIds" argument when using the "isInCampaigns" method.');var d={};d[sfDataIntell.constants.headers.subject]=this.subjectKey,d[sfDataIntell.constants.headers.ids]=a,d[sfDataIntell.constants.headers.datasource]=this.datasource,this.call("/analytics/v1/campaigns/isin",d,b,c)},isInLeads:function(a,b,c,d){if(!a)throw new Error('You must provide "scoringIds" argument when using the "isInLeads" method.');if(!b)throw new Error('You must provide "contactsDetails" argument when using the "isInLeads" method.');var e={};e[sfDataIntell.constants.headers.contacts]=b,e[sfDataIntell.constants.headers.ids]=a,this.call("/analytics/v1/scorings/leads/in",e,c,d)},isInPersonas:function(a,b,c,d){d=d||this.subjectKey;var e={};e[sfDataIntell.constants.headers.datasource]=this.datasource,e[sfDataIntell.constants.headers.subject]=d,e[sfDataIntell.constants.headers.ids]=a,this.call("/analytics/v1/scorings/personas/in",e,b,c)}}}(sfDataIntell);var sfDataIntell=sfDataIntell||{};!function(a){a.PersonalizationClientV2=function(a,b,c,d,e,f){this.apiServerUrl=a,this.subjectKey=b,this.apiKey=c,this.datasource=d,this.authToken=e,this.requester=f},a.PersonalizationClientV2.prototype={call:function(a,b,c,d){if(!this.authToken)throw new Error('You must provide "authToken" when using the Personalization Client.');if(!this.requester)throw new Error("decRequester was not initialized.");var e=this.apiServerUrl+a,f=sfDataIntell.utils.getRequestOptions(null,"GET",e,b);f.headers[sfDataIntell.constants.headers.authorization]=this.authToken,f.headers[sfDataIntell.constants.headers.datacenterkey]=this.apiKey,this.requester.ajaxCall(f,c,d)},isInLeads:function(a,b,c,d){d=d||this.subjectKey;var e={};e[sfDataIntell.constants.headers.datasource]=this.datasource,e[sfDataIntell.constants.headers.subject]=d,e[sfDataIntell.constants.headers.ids]=a,this.call("/analytics/v2/scorings/leads/in",e,b,c)}}}(sfDataIntell);var sfDataIntell=sfDataIntell||{};!function(a){a.MappingsClient=function(a,b){this.apiServerUrl=a.apiServerUrl,this.subject=a.subject,this.apiKey=a.apiKey,this.datasource=a.datasource,this.sentenceClient=b},a.MappingsClient.prototype={addMapping:function(a,b){this.sentenceClient.writeSentence({mappedTo:[{S:a,DS:b}]})}}}(sfDataIntell);var sfDataIntell=sfDataIntell||{};!function(a){a.PageMetadataStore=function(){this.sizeLimiter=1e3,this.localStorageKey="DecPageMetadata",this.indexer=[],this.valueContainer=[]},a.PageMetadataStore.prototype={addMetadata:function(a,b){this.loadFromLocalStorage(),this.indexer.length>=this.sizeLimiter&&(this.indexer.shift(),this.valueContainer.shift(),this.saveToLocalStorage()),this.metadataForPageExists(a)&&this.removeMetadata(a),this.indexer.push(a),this.valueContainer.push(b),this.saveToLocalStorage()},getMetadata:function(a){this.loadFromLocalStorage();var b=this.indexer.indexOf(a);return this.valueContainer[b]},removeMetadata:function(a){this.loadFromLocalStorage();var b=this.indexer.indexOf(a);this.indexer.splice(b,1),this.valueContainer.splice(b,1),this.saveToLocalStorage()},metadataForPageExists:function(a){return this.loadFromLocalStorage(),this.indexer.indexOf(a)>=0},loadFromLocalStorage:function(){if("undefined"!=typeof Storage){var a=localStorage.getItem(this.localStorageKey),b=JSON.parse(a);b?(this.indexer=b.indexer||[],this.valueContainer=b.valueContainer||[]):(this.indexer=[],this.valueContainer=[])}},saveToLocalStorage:function(){if("undefined"!=typeof Storage){var a={};a.indexer=this.indexer,a.valueContainer=this.valueContainer,localStorage.setItem(this.localStorageKey,JSON.stringify(a))}}}}(sfDataIntell);var sfDataIntell=sfDataIntell||{};!function(a){a.PageInfoProvider=function(){},a.PageInfoProvider.prototype={getCurrentPageUrl:function(){return location.href},getCurrentPageReferrer:function(){return document.referrer}}}(sfDataIntell);