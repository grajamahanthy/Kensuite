"use strict";!function(a,o){window.detinationsMap={baseJSONpath:"/ResourcePackages/Talon/assets/dist/data/",portData:(o.getParameterByName("itinerary")||"mediterranean")+".json",apiCall:document.getElementById("destination_id")?"/capi/destination/mapandports/"+document.getElementById("destination_id").dataset.id:"",shipPorts:"",portCoords:[],mapConfig:"",map:"",$map_wrapper:a(".map_area"),$map_nav:a(".map_nav"),mapZoomOffset:.05,initDestinationsMap:function(){this.initMap()},initMap:function(){var o=this,t=window.mainVariables.getData(o.apiCall);t.then(function(t){if(t.ports.length>0){o.shipPorts=t.ports,o.mapConfig=t.mapConfig;for(var e=0,i=o.shipPorts.length;e<i;e++)o.portCoords.push(o.shipPorts[e].geometry.coordinates);window.mainVariables.$window.on("resize",function(){var t=a(this);t.width()<=767&&(o.mapZoomOffset=0,o.mapConfig.zoom=1,o.mapConfig.minZoom=1)}).resize(),o.buildMap()}else a(".ship_details_ports").hide()})},buildMap:function(){var a=this;mapboxgl.accessToken="pk.eyJ1IjoiY3J5c3RhbGNydWlzZXMiLCJhIjoiY2pvZXc1ajZ6MDFoaDNsbnYxcWwwc2RociJ9.UFfseq4ICiTiLmjvjiYyPw",a.map=new mapboxgl.Map({container:"voyage_map",style:"mapbox://styles/crystalcruises/cjoew32kt1en62sl8b5at422u",center:a.mapConfig.center,zoom:a.mapConfig.zoom,maxZoom:a.mapConfig.maxZoom,minZoom:a.mapConfig.minZoom,doubleClickZoom:!1,setClickableIcons:!0,inertia:!0,interactive:!0,attributionControl:{compact:!0}}),a.map.addControl(new mapboxgl.NavigationControl),a.map.scrollZoom.disable(),a.map.on("load",function(){a.map.loadImage("/ResourcePackages/Talon/assets/dist/images/map_2px_main_pin.png",function(o,t){if(o)throw o;a.map.addImage("marker_port_large",t),a.map.loadImage("/ResourcePackages/Talon/assets/dist/images/map_2px_small_pin.png",function(o,t){if(o)throw o;a.map.addImage("marker_port_small",t),a.map.addSource("ports",{type:"geojson",data:{type:"FeatureCollection",features:a.shipPorts}}),a.map.addLayer({id:"ports",type:"symbol",source:"ports",layout:{"icon-image":"marker_port_large","icon-anchor":"bottom","icon-allow-overlap":!0,"text-optional":!1,"icon-size":.65,"icon-ignore-placement":!0,"text-allow-overlap":!0,"text-field":"{placeName}","text-font":["Montserrat Bold","Arial Unicode MS Bold"],"text-size":12,"text-offset":[0,-6.554],"text-anchor":"bottom","text-letter-spacing":.15},paint:{"text-opacity":0}})})}),a.map.on("click","ports",function(t){for(var e=t.features[0].geometry.coordinates.slice(),i=t.features[0].properties.placeName;Math.abs(t.lngLat.lng-e[0])>180;)e[0]+=t.lngLat.lng>e[0]?360:-360;o.setLngLat(e).setHTML(i).addTo(a.map)});var o=new mapboxgl.Popup({closeButton:!1,closeOnClick:!0});a.map.on("mousemove","ports",function(t){for(var e=t.features[0].geometry.coordinates.slice(),i=t.features[0].properties.placeName;Math.abs(t.lngLat.lng-e[0])>180;)e[0]+=t.lngLat.lng>e[0]?360:-360;o.setLngLat(e).setHTML(i).addTo(a.map)}),a.map.scrollZoom.disable()}),window.voyageMap=a.map}}}(jQuery,window.talonUtil);